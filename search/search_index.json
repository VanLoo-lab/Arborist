{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Overview","text":"<p>Arborist is a method to rank SNV clone trees inferred from bulk DNA sequencing data by leveraging low-pass single-cell DNA sequencing (scDNA-seq) data. The method is designed to prioritize the most probable tree, helping to resolve ambiguities in bulk tree inference. Arborist uses variational inference to compute the evidence lower bound on the posterior probability of each tree in the input candidate set and approximates the cell to clone assignment posterior distribution as well as the SNV to SNV cluster assignment posterior. Arborist not only helps to resolve tree ambiguity within the bulk solution space but also helps improve an SNV cluster and yields a natural way to genotype single-cells and derive cell-to-clone assignments for downstream analysis.</p> <p></p> <p>For the code repository, visit Github.</p>"},{"location":"installation/","title":"Installation guide","text":"<p>The <code>arborist</code> package can be installed either via conda (recommended) or manually via <code>pip</code>.  Both methods will automatically install dependencies</p>"},{"location":"installation/#installation-via-conda-recommended","title":"Installation via conda (recommended)","text":"<p><code>arborist</code> is available on Bioconda. You can easy install it via <code>conda/mamba</code> with:</p> <pre><code>conda install -c bioconda -c conda-forge arborist\n</code></pre>"},{"location":"installation/#manual-installation","title":"Manual installation","text":"<p>Clone the repository and install the package using <code>pip</code>. Note: dependencies will be installed automatically</p> <pre><code>git clone https://github.com/VanLoo-lab/Arborist.git\ncd Arborist\npip install .\n\n</code></pre>"},{"location":"installation/#testing-the-installation","title":"Testing the installation","text":"<p>To test the installation of the CLI tool and Python package, run the following:</p> <pre><code>arborist -h\npython -c \"from arborist import arborist\"\n</code></pre>"},{"location":"installation/#dependencies","title":"Dependencies","text":"<p>The <code>arborist</code> package requires the following dependencies:</p> <ul> <li><code>python&gt;=3.7</code></li> <li><code>numpy&gt;=1.20</code></li> <li><code>scipy&gt;=1.7</code></li> <li><code>pandas&gt;=1.3</code></li> <li><code>pygraphviz</code></li> <li><code>numba&gt;=0.61</code></li> <li><code>networkx&gt;=3.6</code></li> </ul>"},{"location":"io/","title":"I/O Formats","text":""},{"location":"io/#input-data","title":"Input Data","text":"<p>Example input files can be found in the example/input directory.</p> <p>Arborist requires three inputs as three separate files: 1.a CSV file containing single-cell variant A and total D read count data 2.a CSV file containing the initial SNV clustering 3.a text file containing the set of candidate clone trees</p>"},{"location":"io/#read-counts-file-format","title":"Read Counts File Format","text":"<p>The input read counts file should be in CSV format contain the following columns with header row in any order: | Column | Description | |---------|------------| | <code>cell</code> | cell identifier, str or int | | <code>snv</code> | SNV identifier, str or int | | <code>total</code> | Total number of reads for cell and SNV | | <code>alt</code> | Number of variant reads for cell and SNV |</p> <p>Example</p> <pre><code>snv,cell,alt,total\n0,4,0,1\n0,5,0,1\n0,29,0,1\n0,45,0,1\n0,48,0,1\n0,64,0,1\n0,76,0,1\n0,92,0,1\n0,97,0,1\n</code></pre>"},{"location":"io/#initial-snv-clustering-file-format","title":"Initial SNV Clustering File Format","text":"<p>The initial SNV clustering file should be in CSV format and contain no headers. The order of the columns matter with the first column being the SNV identifier followed by the initial SNV cluster label. SNV identifiers should be consistent with the read count file and cluster labels should be consistent with the node labels in the candidate tree. Any SNV assigned to an SNV cluster label that is not present in the tree with be initialized with a uniform prior over all SNV clusters. </p> Column Description <code>snv</code> SNV identifier, str or int <code>cluster</code> SNV cluster label, int <p>Example</p> <pre><code>108,2\n123,2\n176,2\n289,2\n452,2\n597,2\n857,2\n890,2\n909,2\n918,2\n</code></pre>"},{"location":"io/#tree-file-format","title":"Tree File Format","text":"<ul> <li>The header for each tree, i.e., '# Tree 1'  must contain '#' but the remaining text is unimportant</li> <li>Each tree consists of delimited separated parent-child relationships. The <code>arborist</code> default delimiter is \" \" but different delimiters may be passed via the <code>--edge-delim</code> argument </li> <li>If clone trees do not contain a normal clone (this is common), then the argument <code>--add-normal</code> should be used to tell <code>arborist</code> to append a normal clone to the root of each clone tree. Any cells assigned to the root will be normal cells. </li> <li>Node identifiers must be integers</li> </ul> <p>Example:</p> <pre><code>    # Tree 1\n    1 2\n    1 3\n    # Tree 2\n    4 5\n    4 6\n</code></pre>"},{"location":"io/#output-data","title":"Output Data","text":"<p>Some example output files are located in the example/output directory. Below is table describing the optional output files from <code>arborist</code></p> argument Description <code>--pickle</code> A pickled dictionary with tree index as key and <code>TreeFit</code> objects containing the fit for each clone tree <code>--draw</code> A visualization of the <code>arborist</code> top ranked clone tree <code>--tree</code> A flat text file similar to the input format containing the <code>arborist</code> top ranked clone tree <code>--ranking</code> a CSV file containg the ranking of the clone trees by the ELBO from best to worst. 'tree_idx' is the order listed in the candidate set <code>--cell-assign</code> a CSV file containing the MAP assignment of cell (id) to clone (assignment) <code>--snv-assign</code> a CSV file containing the MAP assignment of SNV (id) to cluster (assignment) <code>--q_z</code> a CSV file containing the approximate posterior distribution over cell-to-clone labels <code>--q_y</code> a CSV file containing the approximate posterior distribution over SNV-to-cluster labels"},{"location":"package-tutorial/","title":"Package Tutorial","text":"<p>Arborist is also a Python package. Below is an example of how to use it.</p>"},{"location":"package-tutorial/#running-the-arborist-function","title":"Running the <code>arborist</code> function","text":"<pre><code>import pandas as pd \nfrom arborist import read_trees, arborist \n\n#read the trees in as edge lists \ncandidate_trees = read_trees(\"example/input/candidate_trees.txt\")\nprint(f\"Candidate set size: {len(candidate_trees)}\")\n# Candidate set size: 30\n\nread_counts = pd.read_csv(\"example/input/read_counts.csv\")\nread_counts.head()\n\"\"\"\n&gt;&gt;&gt; read_counts.head()\n   snv  cell  alt  total\n0    0     4    0      1\n1    0     5    0      1\n2    0    29    0      1\n3    0    45    0      1\n\"\"\"\n\nsnv_clusters = pd.read_csv(\"example/input/input_clustering.csv\", header=None, names=[\"snv\", \"cluster\"]) \nsnv_clusters.head()\n\"\"\"\n&gt;&gt;&gt; snv_clusters.head()\n   snv  cluster\n0  108        2\n1  123        2\n2  176        2\n3  289        2\n4  452        2\n\"\"\"\n\nranking, best_fit, all_fits =arborist(\n    tree_list = candidate_trees,\n    read_counts = read_counts,\n    snv_clusters = snv_clusters,\n    alpha = 0.001,\n    max_iter = 10,\n    tolerance = 1,\n    gamma= 0.7,\n    add_normal = False,\n    threads = 10,\n    verbose = False\n)\n\nprint(best_fit)\n\"\"\"\nTree 0\nELBO: -311397.27\n 2-&gt;1\n 2-&gt;3\n 2-&gt;4\n 2-&gt;5\n 3-&gt;6\n 0-&gt;2\n\"\"\"\n\n</code></pre>"},{"location":"package-tutorial/#manipulating-treefit-objects-generated-by-arborist","title":"Manipulating <code>TreeFit</code> objects generated by <code>arborist</code>","text":"<p><code>TreeFit</code> objects can be used to obtain MAP assignments of cell-to-clone labels (<code>z</code>) or SNV-to-cluster labels (<code>y</code>) as well as explore the approximate posterior distributions (<code>qz</code>) and (<code>qy</code>)</p> <pre><code>\n#TreeFit \nz = best_fit.map_assign_z()\nz.head()\ny = best_fit.map_assign_y()\ny.head()\n\nqz = best_fit.q_z_df()\nqz.head()\nqy = best_fit.q_y_df()\nqy.head()\n\n\n</code></pre>"},{"location":"usage/","title":"Arborist CLI tool","text":"<p>After installation, <code>arborist</code> can be run via the command line with the following usage:</p> <pre><code>$ arborist -h                                                        \nusage: arborist [-h] -R READ_COUNTS -Y SNV_CLUSTERS -T TREES [--edge-delim EDGE_DELIM] [--add-normal] [--alpha ALPHA] [--max-iter MAX_ITER] [--prior PRIOR]\n                [--pickle PICKLE] [-d DRAW] [-t TREE] [--ranking RANKING] [--cell-assign CELL_ASSIGN] [--snv-assign SNV_ASSIGN] [--q_y Q_Y] [--q_z Q_Z]\n                [-j THREADS] [-v]\n\nArborist: a method to rank SNV clonal trees using scDNA-seq data.\n\noptions:\n  -h, --help            show this help message and exit\n  -R READ_COUNTS, --read_counts READ_COUNTS\n                        Path to read counts CSV file with columns 'snv', 'cell', 'total', 'alt'\n  -Y SNV_CLUSTERS, --snv-clusters SNV_CLUSTERS\n                        Path to SNV clusters CSV file with unlabeled columns 'snv', 'cluster'. The order of columns matters\n  -T TREES, --trees TREES\n                        Path to file containing all candidate trees to be ranked.\n  --edge-delim EDGE_DELIM\n                        edge delimiter in candidate tree file.\n  --add-normal          flag to add a normal clone if input trees do not already contain them\n  --alpha ALPHA         Per base sequencing error\n  --max-iter MAX_ITER   max number of iterations\n  --prior PRIOR         prior (gamma) on input SNV cluster assignment\n  --pickle PICKLE       path to where all pickled tree fits should be saved.\n  -d DRAW, --draw DRAW  Path to where the tree visualization should be saved\n  -t TREE, --tree TREE  Path to save the top ranked tree as a txt file.\n  --ranking RANKING     Path to where tree ranking output should be saved\n  --cell-assign CELL_ASSIGN\n                        Path to where the MAP cell-to-clone labels should be saved\n  --snv-assign SNV_ASSIGN\n                        Path to where the MAP SNV-to-cluster labels should be saved.\n  --q_y Q_Y             Path to where the approximate SNV posterior should be saved\n  --q_z Q_Z             Path to where the approximate cell posterior should be saved\n  -j THREADS, --threads THREADS\n                        Number of threads to use\n  -v, --verbose         Print verbose output\n</code></pre>"},{"location":"usage/#examples","title":"Examples","text":"<p>The following is a minimal <code>arborist</code> example with default parameters and no output files to test the installation.</p> <pre><code>   arborist -R example/input/read_counts.csv \\\n   -T example/input/candidate_trees.txt \\\n   -Y example/input/input_clustering.csv \n</code></pre> <p>If everything installed correctly you should see the following printout:</p> <pre><code>-----------Arborist complete!-----------\n\nTree index 0\nELBO: -311397.27\n 2-&gt;1\n 2-&gt;3\n 2-&gt;4\n 2-&gt;5\n 3-&gt;6\n 0-&gt;2\n</code></pre> <p>This example demonstrates how to modify parameters and write relevant output files. </p> <pre><code>   arborist -R example/input/read_counts.csv \\\n   -T example/input/candidate_trees.txt \\\n   -Y example/input/input_clustering.csv \\\n   --prior 0.7  \\\n   --alpha 0.001 \\\n   --ranking example/output/tree_rankings.csv \\\n   --draw example/output/best_tree.png \\\n   --cell-assign example/output/cell_to_clone_labels.csv \\\n   --snv-assign example/output/snv_to_cluster_labels.csv \n</code></pre>"}]}